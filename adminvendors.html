<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel - Vendors</title>
<link rel="stylesheet" href="venderadmin.css">
</head>
<body>

<header>🏪 Vendor Management</header>

<aside>
  <ul>
    <li><a href="Analytics.html">🏠 Dashboard</a></li>
    <li><a href="affliate.html">📦 Products</a></li>
    <li><a href="adminvendors.html" class="active">🏪 Vendors</a></li>
    <li><a href="admin_affiliates.html">📈 Affiliates</a></li>
    <li><a href="admin_users.html">👥 Users</a></li>
    <li><a href="Analytics.html">📊 Analytics</a></li>
    <li><a href="setting-admin.html">⚙️ Settings</a></li>
  </ul>
</aside>

<main>
  <div id="notification" class="notification"></div>

  <button onclick="openModal('vendor')">Add Vendor</button>
  <input type="text" id="vendor-search" placeholder="Search Vendor..." onkeyup="searchTable('vendor')">

  <table>
    <thead><tr><th>Logo</th><th>Vendor Name</th><th>Status</th><th>Actions</th></tr></thead>
    <tbody id="vendor-list"></tbody>
  </table>

  <div id="vendor-pagination" class="pagination">
    <button onclick="prevPage('vendor')">Prev</button>
    <span id="vendor-page-info">1 / 1</span>
    <button onclick="nextPage('vendor')">Next</button>
  </div>
</main>

<div id="modal" class="modal">
  <div class="modal-content">
    <h3 id="modal-title">Add Vendor</h3>
    <img id="preview" src="" style="display:none;">
    <input type="file" id="image-input" accept="image/*" onchange="previewImage(event)">
    <input type="text" id="modal-name" placeholder="Enter Vendor Name">
    <button onclick="saveItem()">Save</button>
    <button onclick="closeModal()">Cancel</button>
  </div>
</div>

<script>
let data = JSON.parse(localStorage.getItem('adminData')) || {product:[],user:[],vendor:[],affiliate:[]};
let editId=null, rowsPerPage=5, currentPage={vendor:1};

function saveData(){ localStorage.setItem('adminData', JSON.stringify(data)); }

function openModal(type,id=null){
  document.getElementById('modal').style.display='flex';
  document.getElementById('modal-title').innerText = id ? 'Edit Vendor' : 'Add Vendor';
  const name=document.getElementById('modal-name');
  const preview=document.getElementById('preview');
  if(id){
    const item=data[type].find(i=>i.id===id);
    name.value=item.name; preview.src=item.image; preview.style.display=item.image?'block':'none';
  } else { name.value=''; preview.style.display='none'; }
  editId=id;
}

function closeModal(){ document.getElementById('modal').style.display='none'; editId=null; }

function previewImage(e){
  const file=e.target.files[0];
  if(file){
    const reader=new FileReader();
    reader.onload=(evt)=>{ document.getElementById('preview').src=evt.target.result; document.getElementById('preview').style.display='block'; };
    reader.readAsDataURL(file);
  }
}

function saveItem(){
  const name=document.getElementById('modal-name').value.trim();
  const img=document.getElementById('preview').src;
  if(!name){alert('Enter vendor name');return;}
  if(editId){
    const item=data.vendor.find(i=>i.id===editId);
    item.name=name; item.image=img;
  } else {
    data.vendor.push({id:Date.now(), name, image:img, status:'Active'});
  }
  saveData(); renderTable(); closeModal();
}

function renderTable(){
  const tbody=document.getElementById('vendor-list'); tbody.innerHTML='';
  data.vendor.forEach(item=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td><img src="${item.image||'https://via.placeholder.com/50'}" class="thumb"></td>
      <td>${item.name}</td>
      <td>${item.status}</td>
      <td>
        <button class="edit-btn" onclick="openModal('vendor', ${item.id})">Edit</button>
        <button class="delete-btn" onclick="deleteItem(${item.id})">Delete</button>
        <button class="status-btn" onclick="toggleStatus(${item.id})">${item.status==='Active'?'Deactivate':'Activate'}</button>
      </td>`;
    tbody.appendChild(tr);
  });
  updatePagination();
}

function deleteItem(id){
  if(confirm('Are you sure?')){
    data.vendor=data.vendor.filter(i=>i.id!==id);
    saveData(); renderTable();
  }
}

function toggleStatus(id){
  const item=data.vendor.find(i=>i.id===id);
  item.status=item.status==='Active'?'Inactive':'Active';
  saveData(); renderTable();
}

function searchTable(){
  const q=document.getElementById('vendor-search').value.toLowerCase();
  const tbody=document.getElementById('vendor-list');
  Array.from(tbody.children).forEach(row=>{
    row.style.display=row.children[1].innerText.toLowerCase().includes(q)?'':'none';
  });
}

function updatePagination(){
  const tbody=document.getElementById('vendor-list');
  const rows=Array.from(tbody.children);
  const totalPages=Math.ceil(rows.length/rowsPerPage);
  if(currentPage.vendor>totalPages) currentPage.vendor=totalPages||1;
  rows.forEach((r,i)=>r.style.display=(i>=(currentPage.vendor-1)*rowsPerPage&&i<currentPage.vendor*rowsPerPage)?'':'none');
  document.getElementById('vendor-page-info').innerText=`${currentPage.vendor} / ${totalPages||1}`;
}

function nextPage(){currentPage.vendor++;updatePagination();}
function prevPage(){currentPage.vendor--;updatePagination();}

renderTable();

  // Check if admin is logged in
  if (localStorage.getItem("isAdminLoggedIn") !== "true") {
    window.location.href = "admin.login.html"; // not logged in → go back
  }

  // Optional: Logout Button function
  function logout() {
    localStorage.removeItem("isAdminLoggedIn");
    window.location.href = "admin.login.html";
  }


  if(localStorage.getItem("isAdminLoggedIn") !== "true") {
    window.location.href = "admin-login.html";
  }

  function logout() {
    localStorage.removeItem("isAdminLoggedIn"); // login status remove
    window.location.href = "admin-login.html";   // login page वापस
  }
</script>

</script>

</body>
</html>

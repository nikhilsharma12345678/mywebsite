<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel - Affiliates</title>
<link rel="stylesheet" href="admin.affiliate.users.css">
</head>
<body>

<header>
  ğŸ“ˆ Affiliate Management
  <button onclick="logout()">Logout</button>
</header>

<aside>
  <ul>
    <li><a href="index.html">ğŸ  Dashboard</a></li>
    <li><a href="adminproducts.html">ğŸ“¦ Products</a></li>
    <li><a href="vendors.html">ğŸª Vendors</a></li>
    <li><a href="affiliates.html" class="active">ğŸ“ˆ Affiliates</a></li>
    <li><a href="users.html">ğŸ‘¥ Users</a></li>
    <li><a href="Analytics.html">ğŸ“Š Analytics</a></li>
    <li><a href="setting-admin.html">âš™ï¸ Settings</a></li>
  </ul>
</aside>

<main>
  <div id="notification" class="notification"></div>

  <button onclick="openModal('affiliate')">Add Affiliate</button>
  <input type="text" id="affiliate-search" placeholder="Search Affiliate..." onkeyup="searchTable('affiliate')">

  <table>
    <thead><tr><th>Photo</th><th>Name</th><th>Status</th><th>Actions</th></tr></thead>
    <tbody id="affiliate-list"></tbody>
  </table>

  <div id="affiliate-pagination" class="pagination">
    <button onclick="prevPage('affiliate')">Prev</button>
    <span id="affiliate-page-info">1 / 1</span>
    <button onclick="nextPage('affiliate')">Next</button>
  </div>
</main>

<div id="modal" class="modal">
  <div class="modal-content">
    <h3 id="modal-title">Add Affiliate</h3>
    <img id="preview" src="" style="display:none;">
    <input type="file" id="image-input" accept="image/*" onchange="previewImage(event)">
    <input type="text" id="modal-name" placeholder="Enter Affiliate Name">
    <button onclick="saveItem()">Save</button>
    <button onclick="closeModal()">Cancel</button>
  </div>
</div>

<script>
let data = JSON.parse(localStorage.getItem('adminData')) || {product:[],user:[],vendor:[],affiliate:[]};
let editId=null, rowsPerPage=5, currentPage={affiliate:1};

function saveData(){ localStorage.setItem('adminData', JSON.stringify(data)); }

function openModal(type,id=null){
  document.getElementById('modal').style.display='flex';
  document.getElementById('modal-title').innerText = id ? 'Edit Affiliate' : 'Add Affiliate';
  const name=document.getElementById('modal-name');
  const preview=document.getElementById('preview');
  if(id){
    const item=data[type].find(i=>i.id===id);
    name.value=item.name; preview.src=item.image; preview.style.display=item.image?'block':'none';
  } else { name.value=''; preview.style.display='none'; }
  editId=id;
}

function closeModal(){ document.getElementById('modal').style.display='none'; editId=null; }

function previewImage(e){
  const file=e.target.files[0];
  if(file){
    const reader=new FileReader();
    reader.onload=(evt)=>{ document.getElementById('preview').src=evt.target.result; document.getElementById('preview').style.display='block'; };
    reader.readAsDataURL(file);
  }
}

function saveItem(){
  const name=document.getElementById('modal-name').value.trim();
  const img=document.getElementById('preview').src;
  if(!name){alert('Enter affiliate name');return;}
  if(editId){
    const item=data.affiliate.find(i=>i.id===editId);
    item.name=name; item.image=img;
  } else {
    data.affiliate.push({id:Date.now(), name, image:img, status:'Active'});
  }
  saveData(); renderTable(); closeModal();
}

function renderTable(){
  const tbody=document.getElementById('affiliate-list'); tbody.innerHTML='';
  data.affiliate.forEach(item=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td><img src="${item.image||'https://via.placeholder.com/50'}" class="thumb"></td>
      <td>${item.name}</td>
      <td>${item.status}</td>
      <td>
        <button class="edit-btn" onclick="openModal('affiliate', ${item.id})">Edit</button>
        <button class="delete-btn" onclick="deleteItem(${item.id})">Delete</button>
        <button class="status-btn" onclick="toggleStatus(${item.id})">${item.status==='Active'?'Deactivate':'Activate'}</button>
      </td>`;
    tbody.appendChild(tr);
  });
  updatePagination();
}

function deleteItem(id){
  if(confirm('Are you sure?')){
    data.affiliate=data.affiliate.filter(i=>i.id!==id);
    saveData(); renderTable();
  }
}

function toggleStatus(id){
  const item=data.affiliate.find(i=>i.id===id);
  item.status=item.status==='Active'?'Inactive':'Active';
  saveData(); renderTable();
}

function searchTable(){
  const q=document.getElementById('affiliate-search').value.toLowerCase();
  const tbody=document.getElementById('affiliate-list');
  Array.from(tbody.children).forEach(row=>{
    row.style.display=row.children[1].innerText.toLowerCase().includes(q)?'':'none';
  });
}

function updatePagination(){
  const tbody=document.getElementById('affiliate-list');
  const rows=Array.from(tbody.children);
  const totalPages=Math.ceil(rows.length/rowsPerPage);
  if(currentPage.affiliate>totalPages) currentPage.affiliate=totalPages||1;
  rows.forEach((r,i)=>r.style.display=(i>=(currentPage.affiliate-1)*rowsPerPage&&i<currentPage.affiliate*rowsPerPage)?'':'none');
  document.getElementById('affiliate-page-info').innerText=`${currentPage.affiliate} / ${totalPages||1}`;
}

function nextPage(){currentPage.affiliate++;updatePagination();}
function prevPage(){currentPage.affiliate--;updatePagination();}

renderTable();
</script>
</body>
</html>
